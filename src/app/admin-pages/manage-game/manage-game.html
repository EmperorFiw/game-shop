<div class="flex h-screen">
  <app-navbar></app-navbar>

  <main class="flex-1 bg-gradient-to-br from-blue-50 via-white to-indigo-50 ml-64 p-6 overflow-y-auto">
    
    <!-- จัดการเกม -->
    <div class="mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold mb-1">จัดการเกม</h1>
        <h2 class="text-lg">เกมทั้งหมด</h2>
      </div>
      <button (click)="openAddGame()" class="bg-green-100 text-green-600 border border-green-400 px-4 py-2 rounded-md hover:bg-green-200">
        + เพิ่มเกมใหม่
      </button>
    </div>

    <!-- ตารางเกม -->
    <div class="border border-red-300 rounded-lg p-4">
      <table class="w-full border-collapse">
        <thead>
          <tr class="text-left border-b border-red-300">
            <th class="py-2 px-3">ชื่อเกม</th>
            <th class="py-2 px-3">ประเภท</th>
            <th class="py-2 px-3">ราคา</th>
            <th class="py-2 px-3">วันที่วางขาย</th>
            <th class="py-2 px-3">การจัดการ</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let g of games" class="border-b">
            <td class="py-2 px-3">{{ g.name }}</td>
            <td class="py-2 px-3">{{ g.category }}</td>
            <td class="py-2 px-3">{{ g.price }} บาท</td>
            <td class="py-2 px-3">{{ g.release_date | date:'mediumDate' }}</td>
            <td class="py-2 px-3 flex gap-2">
              <button (click)="openGameDetail(g)" class="px-2 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200">
                รายละเอียด
              </button>
              <button (click)="openEditGame(g)" class="px-2 py-1 bg-yellow-100 text-yellow-600 rounded hover:bg-yellow-200">
                แก้ไข
              </button>
              <button (click)="deleteGame(g.id)" class="px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200">
                ลบ
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  <!-- Popup รายละเอียดเกม -->
  <div *ngIf="showGameDetail" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white w-[480px] max-w-[90%] rounded-xl shadow-xl p-6 relative">
      <button (click)="closeGameDetail()" class="absolute top-3 right-3 text-gray-500 hover:text-red-500 text-xl">✕</button>

      <h2 class="text-2xl font-bold mb-4">{{ selectedGame.name }}</h2>

      <img
        [src]="getGameImage(selectedGame.image)"
        alt="ภาพเกม"
        class="w-full h-64 object-contain rounded-lg border mb-4"
      />

      <p><strong>หมวดหมู่:</strong> {{ selectedGame.category }}</p>
      <p><strong>ราคา:</strong> {{ selectedGame.price | number }} บาท</p>
      <p *ngIf="selectedGame.release_date">
        <strong>วันที่วางขาย:</strong> {{ selectedGame.release_date | date:'mediumDate' }}
      </p>

      <p class="mt-4 text-gray-700 whitespace-pre-line">
        {{ selectedGame.description || 'ไม่มีรายละเอียดเพิ่มเติม' }}
      </p>

      <div class="mt-5 flex justify-end">
        <button
          (click)="closeGameDetail()"
          class="px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200"
        >
          ปิด
        </button>
      </div>
    </div>
  </div>

    <!-- Popup เพิ่มเกม -->
    <div *ngIf="showAddGame" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
      <div class="bg-white rounded-lg shadow-xl p-6 w-96">
        <h2 class="text-lg font-semibold mb-4">เพิ่มเกม</h2>

        <input [(ngModel)]="gameData.name" type="text" placeholder="ชื่อเกม" class="w-full border p-2 rounded mb-3" />
        <input [(ngModel)]="gameData.price" type="number" placeholder="ราคา" class="w-full border p-2 rounded mb-3" />
        <select [(ngModel)]="gameData.category" class="w-full border p-2 rounded mb-3">
          <option value="">ประเภทเกม</option>
          <option value="FPS">FPS</option>
          <option value="RPG">RPG</option>
          <option value="Action">Action</option>
          <option value="Simulation">Simulation</option>
        </select>

        <!-- <input type="date" [(ngModel)]="gameData.release_date" class="w-full border p-2 rounded mb-3" /> -->
        <input type="file" (change)="onFileSelected($event)" class="w-full border p-2 rounded mb-3" />

        <img *ngIf="previewUrl" [src]="previewUrl" alt="Preview เกม" class="w-full h-40 object-contain mb-3 border rounded" />

        <textarea [(ngModel)]="gameData.description" placeholder="รายละเอียดเกม" class="w-full border p-2 rounded mb-3"></textarea>

        <div class="flex justify-end gap-2">
          <button (click)="closeAddGame()" class="px-4 py-2 border border-red-400 text-red-600 rounded hover:bg-red-100">
            ยกเลิก
          </button>
          <button (click)="saveGame()" class="px-4 py-2 border border-green-400 text-green-600 rounded hover:bg-green-100">
            {{ editMode ? 'บันทึกการแก้ไข' : 'บันทึก' }}
          </button>
        </div>
      </div>
    </div>
  </main>
</div>
