<div class="flex h-screen">
  <app-navbar></app-navbar>

  <main class="flex-1 bg-gradient-to-br from-blue-50 via-white to-indigo-50 ml-64 p-6 overflow-y-auto">

    <!-- หัวข้อ -->
    <h2 class="text-2xl font-semibold mb-6">จัดการโค้ดส่วนลด</h2>

    <!-- ปุ่มเพิ่มโค้ดใหม่ -->
    <button 
      class="mb-4 px-6 py-2 bg-green-500 text-white font-medium rounded-lg shadow hover:bg-green-600"
      (click)="openAddCodeModal()">
      + เพิ่มโค้ดใหม่
    </button>

    <!-- ตารางแสดงโค้ดส่วนลด -->
    <div class="border-2 border-red-300 rounded-xl bg-white shadow overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-100">
            <th class="px-4 py-2 border">โค้ดส่วนลด</th>
            <th class="px-4 py-2 border">จำนวนที่ลด</th>
            <th class="px-4 py-2 border">จำนวนที่ใช้</th>
            <th class="px-4 py-2 border">ใช้แล้วทั้งหมด</th>
            <th class="px-4 py-2 border">คงเหลือ</th>
            <th class="px-4 py-2 border">วันหมดอายุ</th>
            <th class="px-4 py-2 border">การจัดการ</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="discountCode.length === 0">
            <td colspan="7" class="text-center py-4 text-gray-500">
              ไม่มีโค้ดส่วนลดในระบบ
            </td>
          </tr>
          <tr *ngFor="let code of discountCode" class="text-center">
            <td class="px-4 py-2 border">{{code.code_name}}</td>
            <td class="px-4 py-2 border">{{code.discount}} บาท</td>
            <td class="px-4 py-2 border">{{code.count}}</td>
            <td class="px-4 py-2 border">{{code.used}}</td>
            <td class="px-4 py-2 border">{{code.left}}</td>
            <td class="px-4 py-2 border">{{ code.expire | date: 'yyyy-MM-dd' }}</td>
            <td class="px-4 py-2 border">
              <button class="text-yellow-500 hover:underline mr-2" (click)="openEditCodeModal(code)">แก้ไข</button>
              <button class="text-red-500 hover:underline" (click)="deleteCode(code)">ลบ</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Popup Modal -->
    <div *ngIf="isAddModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
      <div class="bg-white rounded-xl shadow-lg w-1/3 p-6">
        <h3 class="text-xl font-semibold mb-4">
          {{ isEditMode ? 'แก้ไขโค้ดส่วนลด' : 'เพิ่มโค้ดส่วนลดใหม่' }}
        </h3>
        
        <!-- ฟอร์ม -->
        <form (ngSubmit)="saveDiscountCode()">
          <div class="mb-3">
            <label class="block text-gray-700 mb-1">โค้ดส่วนลด</label>
            <input type="text" class="w-full border rounded-lg p-2" [(ngModel)]="newCode.code" name="code">
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 mb-1">จำนวนที่ลด</label>
            <input type="number" class="w-full border rounded-lg p-2" [(ngModel)]="newCode.amount" name="amount">
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 mb-1">จำนวนที่ใช้ได้</label>
            <input type="number" class="w-full border rounded-lg p-2" [(ngModel)]="newCode.count" name="count">
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 mb-1">วันหมดอายุ</label>
            <input type="date" class="w-full border rounded-lg p-2" [(ngModel)]="newCode.date" name="expiry">
          </div>

          <div class="flex justify-end space-x-2 mt-4">
            <button type="button" class="px-4 py-2 bg-gray-300 rounded-lg" (click)="closeAddCodeModal()">ยกเลิก</button>
            <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-lg">
              {{ isEditMode ? 'บันทึกการแก้ไข' : 'บันทึก' }}
            </button>
          </div>
        </form>
      </div>
    </div>

  </main>
</div>
